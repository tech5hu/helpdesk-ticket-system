<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Helpdesk Tickets</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <style>
        /* Active filter highlight */
        .filter-active {
            border: 2px solid #007BFF;
            box-shadow: 0 6px 18px rgba(0, 123, 255, 0.15);
        }
    </style>
</head>
<body>
    <h1>All Tickets {% if filter_type %}- {{ filter_type }}{% endif %}</h1>

    <!-- Stats Cards -->
    <section class="stats-section">
        <a href="{{ url_for('all_tickets') }}" class="stat-card {% if not filter_type %}filter-active{% endif %}">
            <h2>Total Tickets</h2>
            <p class="stat-number">{{ all_tickets|length }}</p>
        </a>
        <a href="{{ url_for('all_tickets', filter='Open') }}" class="stat-card {% if filter_type=='Open' %}filter-active{% endif %}">
            <h2>Open Tickets</h2>
            <p class="stat-number">{{ all_tickets|selectattr('Status', 'equalto', 'Open')|list|length }}</p>
        </a>
        <a href="{{ url_for('all_tickets', filter='High') }}" class="stat-card {% if filter_type=='High' %}filter-active{% endif %}">
            <h2>High Severity</h2>
            <p class="stat-number">{{ all_tickets|selectattr('Severity', 'equalto', 'High')|list|length }}</p>
        </a>
    </section>

    <!-- Actions -->
    <section class="actions-section">
        <a href="{{ url_for('add_ticket_web') }}" class="btn">Add New Ticket</a>
    </section>

    <!-- Tickets Table -->
    <table>
        <thead>
            <tr>
                <th>ID</th>
                <th>Title</th>
                <th>Assignee</th>
                <th>Severity</th>
                <th>Status</th>
                <th>Category</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for ticket in tickets %}
            <tr>
                <td>{{ ticket['ID'] }}</td>
                <td>{{ ticket['Title'] }}</td>
                <td>{{ ticket['Assignee'] }}</td>
                <td>
                    {% if ticket['Severity'].lower() == 'low' %}
                        <span class="badge-low">Low</span>
                    {% elif ticket['Severity'].lower() == 'medium' %}
                        <span class="badge-medium">Medium</span>
                    {% else %}
                        <span class="badge-high">High</span>
                    {% endif %}
                </td>
                <td>{{ ticket['Status'] }}</td>
                <td>{{ ticket['Category'] }}</td>
                <td>
                    <a href="{{ url_for('view_ticket_web', ticket_id=ticket['ID']) }}" class="btn">View</a>
                    <a href="{{ url_for('update_ticket_web', ticket_id=ticket['ID']) }}" class="btn">Update</a>
                    <a href="{{ url_for('delete_ticket_web', ticket_id=ticket['ID']) }}" class="btn">Delete</a>
                    <a href="{{ url_for('comment_ticket_web', ticket_id=ticket['ID']) }}" class="btn">Comment</a>
                    {% if ticket['Status'].lower() != 'closed' %}
                        <form action="{{ url_for('close_ticket_web', ticket_id=ticket['ID']) }}" method="post" style="display:inline;">
                            <button type="submit" class="btn">Close</button>
                        </form>
                        <a href="{{ url_for('escalate_ticket_web', ticket_id=ticket['ID']) }}" class="btn">Escalate</a>
                    {% endif %}
                </td>
            </tr>
            {% else %}
            <tr>
                <td colspan="7" style="text-align:center;">No tickets found for this filter.</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</body>
</html>